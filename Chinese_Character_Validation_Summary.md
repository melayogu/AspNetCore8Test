# FluentValidation ä¸­æ–‡å­—å…ƒé•·åº¦é©—è­‰ç¸½çµ

## æ¸¬è©¦çµæžœ

ç¶“éŽè©³ç´°æ¸¬è©¦ï¼Œæˆ‘å€‘ç¢ºèªäº† FluentValidation åœ¨è™•ç†ä¸­æ–‡å­—å…ƒé•·åº¦é©—è­‰æ™‚çš„è¡Œç‚ºï¼š

### æ ¸å¿ƒç™¼ç¾

1. **å­—å…ƒè¨ˆç®—æ–¹å¼**ï¼š
   - FluentValidation çš„ `Length()` é©—è­‰ä½¿ç”¨ .NET çš„ `string.Length` å±¬æ€§
   - ä¸­æ–‡å­—å…ƒå’Œè‹±æ–‡å­—å…ƒéƒ½è¢«è¨ˆç®—ç‚º 1 å€‹å­—å…ƒå–®ä½
   - é€™å°æ–¼å¤§å¤šæ•¸ä¸­æ–‡æ‡‰ç”¨å ´æ™¯æ˜¯æ­£ç¢ºçš„è¡Œç‚º

2. **å¯¦éš›æ¸¬è©¦æ•¸æ“š**ï¼š
   ```csharp
   "ä¸­" = 1 å­—å…ƒ       // ä¸­æ–‡å­—å…ƒ
   "A" = 1 å­—å…ƒ        // è‹±æ–‡å­—å…ƒ  
   "ä¸­åœ‹" = 2 å­—å…ƒ     // 2å€‹ä¸­æ–‡å­—å…ƒ
   "Hello ä¸–ç•Œ" = 8 å­—å…ƒ // 5è‹±æ–‡ + 1ç©ºæ ¼ + 2ä¸­æ–‡
   ```

3. **ç‰¹æ®Šå­—å…ƒè™•ç†**ï¼š
   - Emoji å­—å…ƒï¼ˆå¦‚ ðŸ˜€ï¼‰å¯¦éš›ä½”ç”¨ 2 å€‹ char ä½ç½®ï¼ˆUnicode surrogate pairï¼‰
   - `string.Length` æœƒå°‡å…¶è¨ˆç®—ç‚º 2 å€‹å­—å…ƒ
   - é€™å°æ–¼å­—æ•¸é™åˆ¶æ˜¯åˆç†çš„ï¼Œå› ç‚º emoji ç¢ºå¯¦ä½”ç”¨æ›´å¤šç©ºé–“

### é©—è­‰è¦å‰‡è¨­è¨ˆ

æˆ‘å€‘çš„ `CreateProductDtoValidator` åŒ…å«ï¼š

```csharp
RuleFor(x => x.Name)
    .NotEmpty()
    .WithMessage("å•†å“åç¨±ä¸èƒ½ç‚ºç©º")
    .Length(2, 100)
    .WithMessage("å•†å“åç¨±é•·åº¦å¿…é ˆåœ¨ 2 åˆ° 100 å€‹å­—å…ƒä¹‹é–“")
    .Must(name => IsValidCharacters(name))
    .WithMessage("å•†å“åç¨±åªèƒ½åŒ…å«å­—æ¯ã€æ•¸å­—ã€ä¸­æ–‡å’Œç©ºæ ¼");
```

### å­—å…ƒè¦å‰‡å‡½å¼

```csharp
private static bool IsValidCharacters(string input)
{
    return input.All(c => 
        char.IsLetterOrDigit(c) || 
        char.IsWhiteSpace(c) || 
        IsCJKCharacter(c));
}

private static bool IsCJKCharacter(char c)
{
    return (c >= 0x4E00 && c <= 0x9FFF) ||   // CJK Unified Ideographs
           (c >= 0x3400 && c <= 0x4DBF) ||   // CJK Extension A
           (c >= 0x20000 && c <= 0x2A6DF) || // CJK Extension B
           (c >= 0x2A700 && c <= 0x2B73F) || // CJK Extension C
           (c >= 0x2B740 && c <= 0x2B81F) || // CJK Extension D
           (c >= 0x2B820 && c <= 0x2CEAF);   // CJK Extension E
}
```

### æ¸¬è©¦è¦†è“‹ç¯„åœ

æˆ‘å€‘å‰µå»ºäº† 16 å€‹æ¸¬è©¦ä¾†é©—è­‰å­—å…ƒé•·åº¦è™•ç†ï¼š

1. **åŸºæœ¬å­—å…ƒé•·åº¦è¨ˆç®—**ï¼ˆ8å€‹æ¸¬è©¦ï¼‰
2. **é‚Šç•Œå€¼æ¸¬è©¦**ï¼ˆ2å€‹æ¸¬è©¦ï¼‰
3. **æ··åˆå­—å…ƒé©—è­‰**ï¼ˆ3å€‹æ¸¬è©¦ï¼‰
4. **Unicode è™•ç†**ï¼ˆ2å€‹æ¸¬è©¦ï¼‰
5. **å­—å…ƒè¦å‰‡é™åˆ¶**ï¼ˆ1å€‹æ¸¬è©¦ï¼‰

### çµè«–

**å°æ–¼ä½ çš„å•é¡Œã€Œé‡å°å­—æ•¸ä¸Šé™çš„æ¸¬è©¦ï¼Œä¸­æ–‡ä¹Ÿé©ç”¨ï¼Ÿã€çš„ç­”æ¡ˆæ˜¯ï¼šæ˜¯çš„ï¼Œå®Œå…¨é©ç”¨ã€‚**

- âœ… ä¸­æ–‡å­—å…ƒå’Œè‹±æ–‡å­—å…ƒåœ¨é•·åº¦é©—è­‰ä¸­è¢«åŒç­‰å°å¾…
- âœ… æ¯å€‹ä¸­æ–‡å­—å…ƒè¨ˆç®—ç‚º 1 å€‹å­—å…ƒå–®ä½
- âœ… FluentValidation çš„ `Length(2, 100)` è¦å‰‡å°ä¸­æ–‡å­—å…ƒæ­£å¸¸å·¥ä½œ
- âœ… 100 å€‹ä¸­æ–‡å­—å…ƒçš„åç¨±æœƒè¢«æ­£ç¢ºé©—è­‰ç‚ºæœ‰æ•ˆ
- âœ… 101 å€‹ä¸­æ–‡å­—å…ƒçš„åç¨±æœƒè¢«æ­£ç¢ºæ‹’çµ•

é€™å€‹è¡Œç‚ºå°æ–¼ä¸­æ–‡æ‡‰ç”¨æ˜¯å®Œå…¨æ­£ç¢ºçš„ï¼Œå› ç‚ºåœ¨ç”¨æˆ¶é«”é©—ä¸Šï¼Œä¸€å€‹ä¸­æ–‡å­—å…ƒç¢ºå¯¦æ‡‰è©²è¢«è¦–ç‚ºä¸€å€‹å­—å…ƒå–®ä½ã€‚

### é¡å¤–æ³¨æ„äº‹é …

- å¦‚æžœéœ€è¦æŒ‰ç…§å¯¦éš›é¡¯ç¤ºå¯¬åº¦ä¾†é™åˆ¶ï¼ˆä¾‹å¦‚ç­‰å¯¬å­—é«”ä¸­ä¸­æ–‡å­—å…ƒé¡¯ç¤ºç‚ºå…©å€å¯¬åº¦ï¼‰ï¼Œéœ€è¦è‡ªå®šç¾©é©—è­‰é‚è¼¯
- å°æ–¼ Unicode surrogate pairsï¼ˆå¦‚æŸäº› emojiï¼‰ï¼Œæœƒè¢«è¨ˆç®—ç‚º 2 å€‹å­—å…ƒï¼Œé€™é€šå¸¸æ˜¯æœŸæœ›çš„è¡Œç‚º
- æˆ‘å€‘çš„å­—å…ƒè¦å‰‡é™åˆ¶ç¢ºä¿åªå…è¨±å­—æ¯ã€æ•¸å­—ã€ä¸­æ–‡å’Œç©ºæ ¼ï¼Œæœ‰æ•ˆé˜²æ­¢ç„¡æ•ˆå­—å…ƒè¼¸å…¥
