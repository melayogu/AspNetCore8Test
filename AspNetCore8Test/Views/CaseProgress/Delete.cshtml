@using AspNetCore8Test.Models.LandSurveyorModels
@model AspNetCore8Test.Models.LandSurveyorModels.CaseProgress

@{
    ViewData["Title"] = "刪除案件進度";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-trash-alt me-2 text-danger"></i>@ViewData["Title"]</h2>
    <a asp-action="Index" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-1"></i>返回列表
    </a>
</div>

<div class="alert alert-danger" role="alert">
    <h4 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>警告</h4>
    <p>您即將刪除以下進度記錄。此操作無法復原，請確認您確實要執行此操作。</p>
    <hr>
    <p class="mb-0">刪除後，相關的進度資訊將永久移除，無法恢復。</p>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5><i class="fas fa-info-circle me-2"></i>即將刪除的進度詳情</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">進度ID</dt>
                    <dd class="col-sm-9">
                        <span class="badge bg-primary">#@Model.Id</span>
                    </dd>

                    <dt class="col-sm-3">關聯案件</dt>
                    <dd class="col-sm-9">
                        @if (Model.Case != null)
                        {
                            <span><i class="fas fa-folder me-1"></i>@Model.Case.CaseNumber - @Model.Case.CaseName</span>
                        }
                        else
                        {
                            <span class="text-muted">未設定案件</span>
                        }
                    </dd>

                    <dt class="col-sm-3">狀態</dt>
                    <dd class="col-sm-9">
                        @switch (Model.Status)
                        {
                            case CaseStatus.Received:
                                <span class="badge bg-secondary">
                                    <i class="fas fa-clock me-1"></i>已收件
                                </span>
                                break;
                            case CaseStatus.Processing:
                                <span class="badge bg-warning">
                                    <i class="fas fa-spinner me-1"></i>處理中
                                </span>
                                break;
                            case CaseStatus.Completed:
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle me-1"></i>已完成
                                </span>
                                break;
                            case CaseStatus.PendingDocuments:
                                <span class="badge bg-danger">
                                    <i class="fas fa-pause-circle me-1"></i>待補件
                                </span>
                                break;
                            case CaseStatus.Submitted:
                                <span class="badge bg-info">
                                    <i class="fas fa-paper-plane me-1"></i>已送件
                                </span>
                                break;
                            case CaseStatus.Cancelled:
                                <span class="badge bg-dark">
                                    <i class="fas fa-times-circle me-1"></i>已取消
                                </span>
                                break;
                            default:
                                <span class="badge bg-light text-dark">@Model.Status</span>
                                break;
                        }
                    </dd>

                    <dt class="col-sm-3">負責人</dt>
                    <dd class="col-sm-9">
                        @if (!string.IsNullOrEmpty(Model.AssignedTo))
                        {
                            <i class="fas fa-user me-1"></i>@Model.AssignedTo
                        }
                        else
                        {
                            <span class="text-muted">未指派</span>
                        }
                    </dd>

                    <dt class="col-sm-3">完成日期</dt>
                    <dd class="col-sm-9">
                        @if (Model.CompletedDate.HasValue)
                        {
                            <i class="fas fa-calendar-alt me-1"></i>@Model.CompletedDate.Value.ToString("yyyy/MM/dd")
                        }
                        else
                        {
                            <span class="text-muted">未完成</span>
                        }
                    </dd>

                    <dt class="col-sm-3">建立時間</dt>
                    <dd class="col-sm-9">
                        <i class="fas fa-clock me-1"></i>@Model.CreatedDate.ToString("yyyy/MM/dd HH:mm")
                    </dd>

                    <dt class="col-sm-3">建立時間</dt>
                    <dd class="col-sm-9">
                        <i class="fas fa-clock me-1"></i>@Model.CreatedDate.ToString("yyyy/MM/dd HH:mm")
                    </dd>
                </dl>

                @if (!string.IsNullOrEmpty(Model.Notes))
                {
                    <div class="mt-3">
                        <h6><i class="fas fa-sticky-note me-2"></i>進度說明</h6>
                        <div class="border rounded p-3 bg-light">
                            @Html.Raw(Model.Notes.Replace("\n", "<br />"))
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h6><i class="fas fa-exclamation-triangle me-2"></i>確認刪除</h6>
            </div>
            <div class="card-body">
                <p class="text-danger">
                    <strong>注意：</strong>此操作無法復原！
                </p>
                
                <p class="small text-muted">
                    刪除此進度記錄後：
                </p>
                <ul class="small text-muted">
                    <li>進度資訊將永久移除</li>
                    <li>相關的時間軸記錄將消失</li>
                    <li>無法恢復已刪除的內容</li>
                </ul>

                <form asp-action="Delete" method="post" class="mt-3">
                    <input asp-for="Id" type="hidden" />
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash-alt me-1"></i>確認刪除
                        </button>
                        
                        <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-outline-info">
                            <i class="fas fa-eye me-1"></i>查看詳情
                        </a>
                        
                        <a asp-action="Index" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-1"></i>取消
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h6><i class="fas fa-lightbulb me-2"></i>建議</h6>
            </div>
            <div class="card-body">
                <p class="small text-muted mb-2">
                    如果您只是想要修改此進度，建議使用「編輯」功能而非刪除。
                </p>
                <div class="d-grid">
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-warning btn-sm">
                        <i class="fas fa-edit me-1"></i>編輯此進度
                    </a>
                </div>
            </div>
        </div>

        @if (Model.Case != null)
        {
            <div class="card mt-3">
                <div class="card-header">
                    <h6><i class="fas fa-folder me-2"></i>關聯案件</h6>
                </div>
                <div class="card-body">
                    <p class="mb-2">
                        <strong>@Model.Case.CaseNumber</strong><br />
                        @Model.Case.CaseName
                    </p>
                    <div class="d-grid">
                        <a asp-controller="Case" asp-action="Details" asp-route-id="@Model.Case.Id" class="btn btn-outline-info btn-sm">
                            <i class="fas fa-external-link-alt me-1"></i>查看案件
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // 表單提交確認
            $('form').submit(function(e) {
                if (!confirm('最後確認：您確定要刪除這筆進度記錄嗎？此操作無法復原！')) {
                    e.preventDefault();
                    return false;
                }
            });

            // 取消按鈕提示
            $('a[href*="Index"]').click(function(e) {
                // 直接返回，不需要確認
            });
        });
    </script>
}